machine:
    environment:
        ALLIGRADER_ENV:                'DEVELOPMENT'
        ALLIGRADER_DB_FLAVOR:          'mysql'
        ALLIGRADER_DB_HOST:            '0.0.0.0'
        ALLIGRADER_DB_PORT:            '3306'
        ALLIGRADER_DB_NAME:            'alligrader'
        ALLIGRADER_DB_URI:             'root:root@(0.0.0.0:3306)/alligrader?parseTime=true'
        ALLIGRADER_GOOSE_DIR:          './db'
        ALLIGRADER_AUTH_CLIENT_ID:     '0c1be3f4d8bec15b046d'
        ALLIGRADER_AUTH_CLIENT_SECRET: '2a4a27c94d8aaddaecb79222fcd5663d38ffbba2'
        ALLIGRADER_STORAGE_PATH:       '/home/vagrant/storage/'
        IMPORT_PATH: "github.com/$CIRCLE_PROJECT_USERNAME/$CIRCLE_PROJECT_REPONAME"

dependencies:
    override:
        - mkdir -p $HOME/.go_project/src/github.com/$CIRCLE_PROJECT_USERNAME
        - ln -fs $HOME/$CIRCLE_PROJECT_REPONAME $HOME/.go_project/src/github.com/$CIRCLE_PROJECT_USERNAME/$CIRCLE_PROJECT_REPONAME
        - echo 'export GOPATH=$GOPATH:$HOME/.go_project' >> ~/.circlerc
        - go get github.com/Masterminds/glide
        - go get bitbucket.org/liamstask/goose/cmd/goose
        - glide up
        - npm install -g dredd
        - cd $HOME/.go_project/src/github.com/$CIRCLE_PROJECT_USERNAME/$CIRCLE_PROJECT_REPONAME && go build -v && cp main ~/$CIRCLE_PROJECT_REPONAME

test:
    override:
        - dredd
        - go test -v -race ./spec/...

